<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
    <title>M02 UF2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/lang-sql.js"></script>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- Bootstrap Core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="../styles.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <a class="navbar-brand" href="../index.html">M02 BASES DE DADES</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="UF1.html">UF1</a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="UF2.html">UF2</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="UF3.html">UF3</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="UF4.html">UF3</a>
            </li>
        </ul>
    </div>
</nav>
<div class="card" style="margin-left:20%;margin-right:20%">
    <br/>
    <br/>
    <br/>
    <h3 class="card-header text-center font-weight-bold text-uppercase py-4">M02 BASES DE DADES</h3>
    <div class="card-body">

        <!-- HERE COMES THE CODE -->


        <h1><span class="primario">M02 UF2</span></h1>
        <h2><span class="secundario">LENGUAJE SQL</span></h2>
        <p>Las sentencias de bases de datos se pueden agrupar en:</p>
        <ul>
            <li><p><span class="primario">DDL</span> (<span class="secundario">Data Definition Language</span>): Definición de la estructura de almacenamiento de datos. Create, drop, alter…</p>
            </li>
            <li><p><span class="primario">DML</span> (<span class="secundario">Data Manipulation Language</span>): Consulta y modificación de datos. Select, Insert, update, delete…</p>
            </li>
            <li><p><span class="primario">DCL</span> (<span class="secundario">Data Control Language</span>): administra el acceso a los datos. Grant, revoke…</p>
            </li>
        </ul>
        <br/>
        <br/>
        <h3>Ordenes <span class="primario">DDL</span> sobre base de datos</h3>
        <p>Para crear una base de datos se realiza con la orden <code>CREATE DATABASE</code> aunque <code>CREATE SCHEMA</code> es sinónima, es decir que hará lo mismo</p>
        <pre class="prettyprint lang-sql"><code><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> NOMBRE_SCHEMA
</code></pre><p>Con la orden <code>DROP [DATABASE | SCHEMA]</code> borramos una base de datos</p>
        <pre class="prettyprint lang-sql"><code><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">DATABASE</span> NOMBRE_SCHEMA
</code></pre>
        <br/>
        <br/>
        <h3>Sintaxis de <span class="primario">CREATE TABLE</span> (crear tabla)</h3>
        <pre class="prettyprint lang-sql"><code>CREATE <span class="hljs-keyword">TABLE</span> nombre_tabla <span class="hljs-comment">(</span>
    nombre_columna tipocolumna [restricciones_columna],
    [nombre_columna tipocolumna [restricciones_columna], ]
    [restricciones_tabla]
);
</code></pre><p>Donde las <span class="secundario">restricciones_columna</span> pueden ser:</p>
        <ul>
            <li><span class="primario">PRIMARY KEY</span> &#8594 Especifica que esta columna es clave primaria.
                NOTA: Una clave primaria puede contener hasta 16 columnas.<ul>
                    <li>No puede haber más de una clave primaria por tabla.</li>
                    <li>Las columnas que la definen deben ser NOT NULL. (Se hace por defecto).</li>
                </ul>
            </li>
            <li><span class="primario">FOREING KEY</span> &#8594 Permite establecer una clave en esta tabla con la clave primaria de otra.</li>
            <li><span class="primario">NOT NULL</span> &#8594 Especifica que la columna debe recibir un valor en la creación o la modificación. La propiedad not null no se admite en el ALTER TABLE.</li>
            <li><span class="primario">NULL</span> &#8594 Especifica que la columna puede tomar valores null.</li>
            <li><span class="primario">DEFAULT</span> &#8594 Fuerza un valor para este campo si no existe.</li>
            <li><span class="primario">AUTO_INCREMENT</span> &#8594 Propiedad aplicada únicamente a columna numérica entera y permite que el sistema genera automáticamente los números de manera incremental.</li>
            <li><span class="primario">UNIQUE</span> &#8594 Permite asignar un valor único a un campo, por lo que todos los valores son diferentes en esa columna. Puede haber varias por tabla.</li>
            <li><span class="primario">CHECK</span> &#8594 Especifica una comprobación en el valor de esta columna. </li>
        </ul>
        <br/>
        <br/>
        <h3>Ejemplo</h3>
        <pre class="prettyprint lang-sql"><code class="lang-roomsql">    <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> PROFESOR (
        <span class="hljs-keyword">ID</span> <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span> AUTO_INCREMENT,
        NOMBRE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
        APELLIDO <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-literal">NULL</span>,
        EDAD <span class="hljs-built_in">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
        PROVINCIA <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'Barcelona'</span>,
        SUELDO <span class="hljs-built_in">INT</span> <span class="hljs-keyword">CHECK</span>(&gt; <span class="hljs-number">5000</span>),
        ASIGNATURA <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span>,
    ) AUTO_INCREMENT = <span class="hljs-number">1000</span>;
</code></pre>
        <ul>
            <li>Si no especifico el <span class="otros">AUTO_INCREMENT</span> empieza en 1.</li>
            <li>Un único <span class="otros">AUTO_INCREMENT</span> por tabla y siempre en la <span class="secundario">Primary Key</span>.</li>
        </ul>
        <br/>
        <br/>
        <h3>Ejemplo</h3>
        <pre class="prettyprint lang-sql"><code class="lang-roomsql">    create table usuario(
        numero int auto_increment,
        documento char(<span class="hljs-number">8</span>),
        nombre varchar(<span class="hljs-number">30</span>),
        estudios <span class="hljs-class"><span class="hljs-keyword">enum</span>('<span class="hljs-title">ninguno</span>','<span class="hljs-title">primario</span>','<span class="hljs-title">secundario</span>','<span class="hljs-title">universitario</span>'),</span>
        primary key (numero)
    )
</code></pre>
        <ul>
            <li>Forma exclusiva de MySql para crear la <span class="secundario">Primary Key</span>.</li>
        </ul>
        <br/>
        <br/>
        <h3 class="primario">CONSTRAINTS</h3>
        <pre class="prettyprint lang-sql"><code>CREATE <span class="hljs-keyword">TABLE</span> nombre_tabla <span class="hljs-comment">(</span>
    nombre_columna tipocolumna [restricciones_columna],
    [nombre_columna tipocolumna [restricciones_columna], ]
    [restricciones_tabla]
);
</code></pre><p>Podemos, del mismo modo, crear restricciones <span class="otros">(CONSTRAINTS)</span> al final de la especificación de tablas (<span class="secundario">restricciones_tabla</span>) con los comandos:</p>
        <ul>
            <li><span class="otros">CONSTRAINT</span> nombrerestriccion <span class="primario">DEFAULT</span> valor FOR nombrecolumna</li>
            <li><span class="otros">CONSTRAINT</span> nombrerestriccion <span class="primario">PRIMARY KEY</span> (nombrecolumna1,....)<ul>
                <li>NOTA: Es la única manera de hacer una clave primaria compuesta.</li>
            </ul>
            </li>
            <li><span class="otros">CONSTRAINT</span> nombrerestriccion <span class="primario">UNIQUE</span> (nombrecolumna1, ...)</li>
            <li><span class="otros">CONSTRAINT</span> FK_ nombrerest <span class="primario">FOREIGN KEY</span> (nombrecol) <span class="primario">REFERENCES</span> NombreTabla (columnaId)<ul>
                <li>NOTA: Es la única manera de hacer una clave foranea.</li>
            </ul>
            </li>
        </ul>
        <br/>
        <br/>
        <h3>Ejemplo</h3>
        <pre class="prettyprint lang-sql"><code class="lang-roomsql">    <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> PROFESOR (
        <span class="hljs-keyword">ID</span> <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
        NOMBRE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>),
        APELLIDO <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>),
        EDAD <span class="hljs-built_in">DATE</span>,
        PROVINCIA <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>),
        SUELDO <span class="hljs-built_in">INT</span>,
        ID_ASIGNATURA <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>),
        <span class="hljs-keyword">CONSTRAINT</span> PK_PROFESOR PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-keyword">ID</span>),
        <span class="hljs-keyword">CONSTRAINT</span> UNIQUE_PROFESOR_ASIGNATURA <span class="hljs-keyword">UNIQUE</span> (NOMBRE),
        <span class="hljs-keyword">CONSTRAINT</span> PROVINCIA_DEFAULT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'Barcelona'</span> <span class="hljs-keyword">FOR</span> PROVINCIA,
        <span class="hljs-keyword">CONSTRAINT</span> FK_PROFESOR_ASIGNATURA FOREIGN <span class="hljs-keyword">KEY</span> (ID_ASIGNATURA) <span class="hljs-keyword">REFERENCES</span> ASINTATURAS (<span class="hljs-keyword">ID</span>)
    );
</code></pre>
        <br/>
        <br/>
        <h2><span class="primario">Actividad 1</span></h2>
        <p>Dadas las tablas, <span class="secundario">CLIENTES</span> y <span class="secundario">FACTURAS</span>, crea un script para cada una de ellas:</p>
        <pre class="prettyprint lang-sql"><code>CLIENTES
CIF (<span class="hljs-name">PK</span>)
Nombre (<span class="hljs-name">no</span> nulo)
Direccion
Poblacion (<span class="hljs-name">default</span> ‘Barcelona’)
Web
Correo
</code></pre><hr>
        <pre class="prettyprint lang-sql"><code>FACTURAS
Idfactura (<span class="hljs-name">PK</span> - autoincremental empieza en <span class="hljs-number">100</span> y no nula)
Fechafactura
Total (<span class="hljs-name">n</span>úmero con dos decimales)
Iva (<span class="hljs-name">check</span> de mínimo <span class="hljs-number">21</span>)
Descuento (<span class="hljs-name">Permite</span> nulos)
CIF (<span class="hljs-name">FK</span> CLIENTE)
</code></pre>
        <br/>
        <br/><details>
        <summary><span class="secundario solucion">Solución</span></summary>

        <pre class="prettyprint lang-sql">
CREATE TABLE CLIENTES (
    CIF int primary key auto_increment,
    nombre varchar(30) not null,
    direccion varchar(100),
    poblacion varchar(100) default &#39;Barcelona&#39;,
    web varchar(60),
    correo varchar(40)
);
</pre>
        <hr>
        <pre class="prettyprint lang-sql">
CREATE TABLE facturas (
    Idfactura int auto_increment primary key not null,
    Fechafactura date,
    total decimal(10,2),
    iva decimal(10,2),
    descuento decimal(10,2) check(descuento&gt;20),
    CIF int,
    constraint fk_clientes_facturas foreign key(CIF) references CLIENTES(CIF)
) auto_increment = 100;</pre>
    </details>

        <br/>
        <br/>
        <h3 class="primario">Actividad 2</h3>
        Crea el script de base de datos para el diagrama relacional siguiente:<br/>
        <img src="../images/Ejercicio clase I.jpg" class="img-fluid" alt="Responsive image">
        <br/>
        <br/>
        <details>
        <summary><span class="secundario solucion">Solución</span></summary>

        <pre class="prettyprint lang-sql">
CREATE TABLE CLIENTES (
    ID_CLIENTE INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    NOMBRE VARCHAR(50),
    DIRECCION VARCHAR(100),
    TELEFONO CHAR(9)
);

CREATE TABLE FACTURAS (
    ID_FACTURA INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    FECHA DATE,
    ID_CLIENTE INT NOT NULL,
    CONSTRAINT FK_cliente FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTES (ID_CLIENTE)
);

CREATE TABLE CATEGORIAS (
    ID_CATEGORIA INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    DESCRIPCION VARCHAR(100)
);

CREATE TABLE PROVEEDORES (
    ID_PROVEEDOR INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    NOMBRE VARCHAR(50),
    DIRECCION VARCHAR(100),
    TELEFONO CHAR(9)
);

CREATE TABLE PRODUCTOS (
    ID_PRODUCTO INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    DESCRIPCION VARCHAR(100),
    PRECIO DECIMAL(10,2),
    ID_CATEGORIA INT NOT NULL,
    ID_PROVEEDOR INT NOT NULL,
    CONSTRAINT fk_categoria FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIAS (ID_CATEGORIA),
    CONSTRAINT fk_proveedor FOREIGN KEY (ID_PROVEEDOR) REFERENCES PROVEEDORES (ID_PROVEEDOR)
);

CREATE TABLE VENTAS (
    ID_VENTA INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    ID_FACTURA INT NOT NULL,
    ID_PRODUCTO INT NOT NULL,
    CANTIDAD INT NOT NULL,
    CONSTRAINT FK_factura FOREIGN KEY (ID_FACTURA) REFERENCES FACTURAS (ID_FACTURA),
    CONSTRAINT FK_producto FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTOS (ID_PRODUCTO)
);
        </pre>
            El orden del script es importante, ya que no puedo crear una tabla en base de datos que tiene una clave foránea
            si no se ha creado primero la tabla de donde procede esa clave foránea.<br/>
        </details>

        <br/>
        <br/>
        <h3 class="primario">Actividad 3</h3>
        Ahora crea el script de base de datos del siguiente modelo relacional en el orden correcto.<br/>
        <img src="../images/Ejercicio clase II.png" class="img-fluid" alt="Responsive image">
        <br/>
        <br/>
        <details>
            <summary><span class="secundario solucion">Solución</span></summary>

            <pre class="prettyprint lang-sql">
CREATE TABLE POLIZA (
    NUM_POLIZA INT PRIMARY KEY NOT NULL,
    PRECIO DECIMAL(10,2),
    TIPO VARCHAR(10),
    FECHA_VENCIMIENTO DATE,
    FECHA_CONTRATACION DATE
);

CREATE TABLE CLIENTE (
    DNI CHAR(9) PRIMARY KEY NOT NULL,
    NOMBRE VARCHAR(50),
    DIRECCION VARCHAR(100),
    TELEFONO CHAR(9),
    NUM_POLIZA INT,
    CONSTRAINT FK_poliza FOREIGN KEY (NUM_POLIZA) REFERENCES POLIZA (NUM_POLIZA)
);

CREATE TABLE SUCURSAL (
    NUM_SUCURSAL INT PRIMARY KEY NOT NULL,
    DIRECCION VARCHAR(100),
    NUM_POLIZA INT,
    CONSTRAINT FK_poliza_sucursal FOREIGN KEY (NUM_POLIZA) REFERENCES POLIZA (NUM_POLIZA)
);

CREATE TABLE PERSONAL (
    DNI CHAR(9) PRIMARY KEY NOT NULL,
    NOMBRE VARCHAR(50),
    APELLIDO1 VARCHAR(50),
    APELLIDO2 VARCHAR(50),
    TELEFONO CHAR(9),
    NUM_CUENTA_CORR CHAR(13),
    NUM_SUCURSAL INT NOT NULL,
    CONSTRAINT FK_suc_personal FOREIGN KEY (NUM_SUCURSAL) REFERENCES SUCURSAL (NUM_SUCURSAL)
);


CREATE TABLE PRINCIPAL (
    NUM_SUCURSAL INT AUTO_INCREMENT,
    DNI CHAR(9),
    CONSTRAINT PK_ppal PRIMARY KEY (NUM_SUCURSAL),
    CONSTRAINT FK_sucursal_ppal FOREIGN KEY (NUM_SUCURSAL) REFERENCES SUCURSAL (NUM_SUCURSAL),
    CONSTRAINT FK_DNI_ppal FOREIGN KEY (DNI) REFERENCES PERSONAL (DNI)
);

CREATE TABLE DEPARTAMENTO (
    NUM_SUCURSAL INT AUTO_INCREMENT,
    DNI CHAR(9),
    NUM_SUC_PPAL INT,
    CONSTRAINT PK_dep PRIMARY KEY (NUM_SUCURSAL),
    CONSTRAINT FK_sucursal_dep FOREIGN KEY (NUM_SUCURSAL) REFERENCES SUCURSAL (NUM_SUCURSAL),
    CONSTRAINT FK_suc_dep_ppal FOREIGN KEY (NUM_SUC_PPAL) REFERENCES PRINCIPAL (NUM_SUCURSAL),
    CONSTRAINT FK_DNI_dep FOREIGN KEY (DNI) REFERENCES PERSONAL (DNI)
);
        </pre>
        </details>

        <!-- HERE ENDS THE CODE -->
        <br/>
        <br/>
        <br/>
        <br/>

    </div>
</div>
</body>
</html>
